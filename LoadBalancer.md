# Load balancer

那麼究竟什麼是负载均衡呢？通俗些講，就是我們有幾十台、幾百台甚至更多服務器，將這些服務器組成一個服務器集群，當客戶端訪問某台設備的數據時，首先發送的請求先到一台中間服務器，並通过中间服务器在服务器集群中平均分摊到其他服务器中，因此，當用戶每次所發送的請求都將會保证服务器集群中的设备均与平摊，以此来分担服务器的压力，从而保持服务器集群的整理性能最优，避免出現有崩潰的現象。

3種負載均衡架構：

  1.鏈路負載均衡（基於DNS）

![Loadbalancer](/images/10154499-b55b98c9c47a1a8b.webp)

即DNS解析為不同IP，用戶通過IP訪問不同服務器，負載均衡由DNS解析控制
優點：用戶會直接訪問目標服務器，不經過代理服務器，訪問速度會更快
缺點：DNS在用戶本地和LDNS均有緩存，某台Web Server掛掉，將很難及時更新用戶域名解析結構，導致用戶無法訪問域名（配置修改後，生效不及時）

2.集群負載均衡

分為硬件負載和軟件負載
![Loadbalancer](/images/10154499-602bd10813e90186.webp)

使用一台專門硬件設備轉發請求，比如大名鼎鼎的F5 Network Big-IP，性能好，但價格昂貴，負載均衡的算法方面還支持很多靈活的策略，同時還具有一些防火牆等安全功能，不能動態擴容（無法面對訪問量陡然增大超出服務極限問題）

3.軟件負載
![Loadbalancer](/images/10154499-a5fe4bda2c8a11f7.webp)

最普遍的方式，直接使用PC搭建，但一般一次訪問請求要經過多次代理服務器，增加網絡延時，需要投入技術優化成本

## 常見的負載均衡方案有哪些？

![Loadbalancer](/images/06r732105n614198n9o6s9qnnnpnp9p1.jpg)

負載均衡（Load Balance）是分佈式系統架構設計中必須考慮的因素之一，它通常是指，將請求/數據均勻分攤到多個操作單元上執行，其的關鍵在於均勻：

反向代理層的負載均衡，是通過「DNS輪詢」實現的

站點層的負載均衡，是通過「nginx」實現的

服務層的負載均衡，是通過「服務連接池」實現的

數據層的負載均衡，要考慮「數據的均衡」與「請求的均衡」兩個點，常見的方式有「按照範圍水平切分」與「hash水平切分」

## 負載均衡算法

在有負載均衡的以上幾種架構後，那麼選擇哪一台服務器也是需要一定算法的，有以下幾種經典的算法：

    輪詢策略

實際應用中，輪詢也會有多種方式，有按順序輪詢的、有隨機輪詢的、還有按照權重來輪詢的。前兩種比較好理解，第三種按照權重來輪詢，是指給每台後端服務設定一個權重值，比如性能高的服務器權重高一些，性能低的服務器給的權重低一些，這樣設置的話，分配流量的時候，給權重高的更多流量，可以充分的發揮出後端機器的性能。

    負載度策略

負載度策略是指當「負載均衡器」往後端轉發流量的時候，會先去評估後端每台服務器的負載壓力情況，對於壓力比較大的後端服務器轉發的請求就少一些，對於壓力比較小的後端服務器可以多轉發一些請求給它。

這種方式也帶來了一些弊端，因為需要動態的評估後端服務器的負載壓力，那這個「負載均衡器」除了轉發請求以外，還要做很多額外的工作，比如採集連接數、請求數、 CPU負載指標、IO負載指標等等，通過對這些指標進行計算和對比，判斷出哪一台後端服務器的負載壓力較大。

    響應策略

響應策略是指，當用戶請求過來的時候，「負載均衡器」會優先將請求轉發給當前時刻響應最快的後端服務器（不管服務器負載度、配置）

    哈希策略

將請求中的某個信息進行hash計算，然後根據後端服務器台數取模，得到一個值，算出相同值的請求就被轉發到同一台後端服務器中。

常見的用法是對用戶的IP或者ID進行這個策略，然後「負載均衡器」就能保證同一個IP來源或者同一個用戶永遠會被送到同一個後端服務器上了，一般用於處理緩存、會話等功能的時候特別好用。
