# Domain Name System

DNS 域名系統 (Domain Name System)

  網路是由無限多的電腦連線所構成，為了確保資料流動的正確性，每台電腦
都有「固定而且單一」的「地址」，即是0～255數字所組成的IP位址。隨著連線
主機的增加，要記住這些數字字串並不容易，因此在20世紀末美國Wisconsin大學
提出「網域名稱」轉換機制，並定義出名稱伺服器（Domain Name Server）。
　　

網域名稱的運作機制，就是將難以記憶的數字，改採有意義的英文字來代表。
例如：網路中文網域名稱為：www.net-chinese.com.tw，透過DNS解析，即可以指到
：202.153.205.73這台主機，於是我們就可以不必背誦一串難記且無意義的數字，
只要記得網域名稱，就可以順利找到該網站。簡而言之，DNS 伺服器就是擔任網
域名稱與 IP 雙向解析的角色。

![DNS](/images/1145660-20170503125208570-1251197118.png)



DNS不僅是用來解析網域名稱與 IP，它還可以回應很多關於網路和主機的其它訊息。為了要達到這個功能，必需將不同的「記錄」設定於DNS裏，而這些「記錄」就是我們所說的RR TYPE（resource record types），目前較常用的有A、MX、CNAME、NS等記錄。
 	四種基本記錄的用途解說：

| 記錄 | 用途說明 |
| ---------- | --- |
|A |對應主機名稱和其IP位址，這是最常用也是最重要的記錄。|
|MX|MX 郵件交換記錄，凡是收發internet信件的主機，都需要設定MX紀錄，才可以正常地收發internet信件。|
|CNAME|「別名」記錄，可以讓A記錄使用其他（或多個）名稱。|


以下針對四種常用的記錄來做設定講解：

1. A 記錄：(以域名abc.com為例，)

|  |  |
| ---------- | --- |
| 格式 |HOST　IN　 A　 IP Address|
| 範例 |www.abc.com　 IN　 A　 232.61.23.15 |
|說明|www.abc.com對應的主機位置IP為232.61.23.15，當我們在瀏覽器網址列輸入：www.abc.com，透過DNS解析會找到232.61.23.15的主機，如果在網址列直接輸入：232.61.23.15，也是可以找到網站主機。|
|應用|假如你架設一個網站(WEB SERVER)，IP位置：為203.71.252.13，只要再申請網域名稱，透過DNS代管設定A記錄，網友就可以經由你所申請的網域名稱到達你的網站，如：www.abc.com。|

2. MX 紀錄：(以域名abc.com為例)

|  |  |
| ---------- | --- |
|格式|	HOST　　 IN　MX　優先序號 　Mairl- Server|
|範例|Mail-Server為：ms1.abc.com、ms2.abc.com   abc.com　 IN　MX　10　　ms1.abc.com abc.com　 IN　MX　20　　ms2.abc.com|
|說明|1. 當有人要寄信到xxx@abc.com的信箱時，會把信寄到ms1.abc.com這台主機上，如果ms1.abc.com沒有反應無法收信時，就會將信寄到ms2.abc.com這台主機上。2. 優先序號的設定是表示誰是第一台主機，誰是第二台主機，優先序號數值小者為第一台主機，以此類推。3. 當設定MX記錄時，需先至A記錄設定Mail Server的IP Adress。Mail Server A記錄設定如下：ms1.abc.com　IN　A　231.5.123.4ms2.abc.com　IN　A　243.124.235.13|
|應用|假如你架設一台Mail Server，只要再申請一個網域名稱，透過DNS代管設定MX記錄，你就可以使用擁有自己網域名稱的Email Address來收發信件。service@abc.commarket@abc.commarry@abc.com|


3. CNAME 記錄：(以域名abc.com為例)

|  |  |
| ---------- | --- |
|格式|	別名　　 IN　CNAME　　　　HOST|
|範例|	www.abc.com　IN　A　232.61.23.15web.abc.com　 IN　CNAME　www.abc.com|
|說明|在網址列輸入：www.abc.com 或web.abc.com都會到達同個網站（232.61.23.15），其實CNAME記錄就好像是A記錄的分身，幫已存在的A紀錄設定其它的名字。|
|應用|	假如你架設一個網站，IP位置為203.71.252.13，只要再申請一個網域名稱，透過DNS代管設定A記錄，網友就可以經由你所申請的網域名稱找到你的網站。如果你再利用CNAME記錄，就可以為你的網站再取個別名，如：web.abc.com mail.abc.com|


域名結構：

     因採用了層次樹狀結構的命名方法。

     任何一個連接的主機或路由器，都有一個唯一的層次結構的名字，即域名。

     域名的結構由標號序列組成，各標號之間用點隔開：… . 三級域名 . 二級域名 . 頂級域名

     各標號分別代表不同級別的域名


       (1) 國家頂級域名nTLD ：如:.us 表示美國，.uk 表示英國，等等。

       (2) 通用頂級域名gTLD ：最早的頂級域名是：

           .com   （公司和企業）

           .net   （網絡服務機構）

           .org   （非贏利性組織）

           .edu   （教育機構）

           .gov   （政府部門）

           .mil   （軍事部門）

           .int    （國際組織）

## DNS 的工作過程

1.用戶在瀏覽器輸入www.googlre.com域名，操作系統先檢查自己本地的hosts文件是否有這個網址相關的映射關係。有的話，先調用這個映射，完成域名解析。

2.hosts文件中沒有這個域名的映射，則查找本地的DNS解析器緩存，查看是否有這個網址的映射關係。如果有,直接返回,完成域名解析。

3.如果hosts與本地DNS解析器緩存都沒有相應的網址映射關係,首先會找TCP/IP參數中設置的首選DNS服務器,在此我們叫它本地DNS服務器,此服務器收到查詢時,如果要查詢的域名,包含在本地配置區域資源中,則返回解析結果給客戶機,完成域名解析,此解析具有權威性。

4.如果要查詢的域名,不由本地DNS服務器區域解析,但該服務器已緩存了此網址映射關係,則調用這個IP地址映射,完成域名解析,此解析不具有權威性。

5.如果本地DNS服務器本地區域文件與緩存解析都失效,則根據本地DNS服務器的設置(是否設置轉發器)進行查詢,如果未用轉發模式,本地DNS就把請求發至13台根DNS,根DNS服務器收到請求後會判斷這個域名(.com)是誰來授權管理,並會返回一個負責該頂級域名服務器的一個IP。本地DNS服務器收到IP信息後,將會聯繫負責.com域的這台服務器。這台負責.com域的服務器收到請求後,如果自己無法解析,它就會找一個管理.com域的下一級DNS服務器地址( xx.com )給本地DNS服務器。當本地DNS服務器收到這個地址後,就會找qq.com域服務器,重複上面的動作,進行查詢,直至找到www.qq.com主機。

6 .如果用的是轉發模式,此DNS服務器就會把請求轉發至上一級DNS服務器,由上一級服務器進行解析,上一級服務器如果不能解析,或找根DNS或把轉請求轉至上上級,以此循環。不管是本地DNS服務器用的是轉發,還是根提示,最後都是把結果返回給本地DNS服務器,由此DNS服務器再返回給客戶機。

注：從客戶端到本地DNS服務器是屬於遞歸查詢,而DNS服務器之間就是迭代查詢。