# 非同步機制 anachronism

非同步（Asynchronous，又稱異步）指的是各方在方便或可能時，才接收並處理訊息，而不是立刻這麼做的通訊環境。

你可以用人類的溝通環境來比喻：例如電子郵件，寄件者傳送電郵、收件者會在方便時才回覆。他們不用馬上就那麼做。

它也可以用來描述一個程式性的通信環境，例如 Ajax 就是個請求 HTTP 少量數據的非同步機制。結果會在響應完成時發回，而不是立刻發送。


## 非同步應用的範圍

在同一個行程中，要進行非同步的作業，多執行緒是一個常見的實作方式。當主執行緒A打算執行某個工作B時，它可以產生另一個獨立的執行緒以執行工作B，而自己仍可在不停滯等待的情況下，繼續執行其他的工作。當然，主執行緒A很有可能必須知道工作B是否完成，以便處理不同的工作或做不同的決策。

## 當非同步工作太多時，怎麼辦？
有些時候我們可能會同時要求多個非同步工作的執行，但是，受限於資源（例如計算力不足），所以，同時間只能執行一定數目的非同步工作。這時候，時常會運用所謂的工作佇列（Task Queue或Job Queue）。當要求非同步工作的執行時，便將相關的工作資訊置入工作佇列中，而每當有閒置可用的計算資源，例如執行緒時，便從工作佇列中取出工作資訊，並且加以執行。而實作工作佇列的方式也有很多種，可以使用資料庫來自行實作，也有很多人使用專門的訊息佇列伺服器（Message Queue）。

## 訊息佇列 Message Queue

訊息佇列用來接收、保留以及傳遞訊息。如果一個操作按照順序執行太慢的時候，你可以透過訊息佇列和以下的流程搭配來完成此工作：

應用程式將訊息發送到佇列中，並通知使用者對應的狀態

一個 worker 從佇列中拿出該訊息並進行處理，然後完成後顯示對應資訊

這樣的工作流程，使用者不會被阻塞，同時工作會在背景完成。在這段期間，客戶端可以進行一些處理讓此任務看起來已經完成了。例如，當你要發送一則推文訊息時，此訊息可以馬上出現在你的時間軸上，但可能需要一段時間才會發送到你的追蹤者上面。



RabbitMQ 很受歡迎，但你必須要使用 AMQP 通訊協定，並且要自己管理節點。

Amazon SQS 是一個被 AWS 託管的服務，但可能會有高延遲，並且訊息可能會被傳送兩次。